# 2025 SNU FastMRI Challenge | *Team sMaRtIfy*

English $\rightarrow$ `./README_en.md`

---
![image](docs/smartify.png)

*"ê±°ì¸ì˜ ì–´ê¹¨ì— ì˜¬ë¼ì„œì„œ ë” ë„“ì€ ì„¸ìƒì„ ë°”ë¼ë³´ë¼"* $-$ ì•„ì´ì‘ ë‰´í„´ 

ì €í¬ íŒ€ì€ ì„¸ìƒì— ì•Œë ¤ì§„ ì†Œì¤‘í•œ ì •ë³´ë¥¼ ì ì ˆíˆ ëª¨ìœ¼ê³  ì €í¬ë§Œì˜ ì°½ì˜ì ì¸ ë°©ì‹ìœ¼ë¡œ ì¬ê²°í•©í•˜ì—¬, ì„¸ìƒì— ë„ì›€ì´ ë˜ëŠ” ëšœë ·í•œ ì„±ê³¼ë¥¼ ë‚´ê³ ì í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì €í¬ì˜ ëª©í‘œë¥¼ ë‹´ì•„, ê¸°ì¡´ì˜ ì§€ì‹ì„ í‘œìƒí•˜ëŠ” **fastMRI**ë¥¼ ì ì ˆíˆ ì¬ë°°ì—´í•˜ì—¬ **sMaRtIf**ë¼ëŠ” ë‹¨ì–´ë¥¼ ë§Œë“¤ì—ˆê³ , ì´ëŸ¬í•œ ì¡°í•©ì„ í†µí•´ ëšœë ·í•œ ì„±ê³¼ì¸ *target label*, ì¦‰ $\textcolor{olive}{\mathbf{y}}$ ë²¡í„°ë¥¼ ì–»ì–´ë‚¸ë‹¤ëŠ” ì˜ë¯¸ë¡œ íŒ€ëª… **sMaRtIf**$\textcolor{olive}{\mathbf{y}}$ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

---

#### [Seongsu Lee](https://linktr.ee/seongsulee)
* Undergrad. @ Department of Physics Education | $\tiny\textsf{Mar 2020 - Current}$
Double major in Biological Sciences, Computer Science & Engineering
* Email | dltjdtn0727@snu.ac.kr

#### Woojin Lee
* Undergrad. @ Department of Materials Science and Engineering | $\tiny\textsf{Mar 2021 - Current}$
Double major in Electrical & Computer Engineering
* Email | eugene5759@snu.ac.kr

---

## 1. ëŒ€íšŒ ê°œìš”

ë³¸ ëŒ€íšŒëŠ” [ì„œìš¸ëŒ€í•™êµ ì „ê¸°ì •ë³´ê³µí•™ë¶€](https://ece.snu.ac.kr/)ì˜ [LIST](https://list.snu.ac.kr/) ì—°êµ¬ì‹¤ì´ ì£¼ê´€í•˜ê³  [AIRS Medical](https://airsmed.com/)ì´ í›„ì›í•˜ëŠ” ëŒ€íšŒë¡œ, NYUì˜ [FastMRI dataset](https://fastmri.med.nyu.edu/)ê³¼ Facebook AI ë° NeurIPSì˜ [FASTMRI Challenge](https://github.com/facebookresearch/fastMRI?tab=readme-ov-file)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.

MRI(Magnetic Resonance Imaging)ëŠ” ìê¸°ì¥ì„ ì´ìš©í•˜ì—¬ ì¸ì²´ ë‚´ë¶€ êµ¬ì¡°ë¥¼ ë¹„ì¹¨ìŠµì ìœ¼ë¡œ ì´¬ì˜í•˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤. ì‹ ì†í•œ ì´¬ì˜ì„ ìœ„í•´ k-spaceë¥¼ ë¶€ë¶„ ìƒ˜í”Œë§í•˜ë©´ ì •ë³´ ì†ì‹¤ë¡œ ì¸í•´ ì´ë¯¸ì§€ í™”ì§ˆì´ ì €í•˜ë˜ëŠ”ë°, ì´ë¥¼ ê³ í’ˆì§ˆ ì˜ìƒìœ¼ë¡œ ë³µì›í•˜ëŠ” ì•Œê³ ë¦¬ì¦˜ì„ ì„¤ê³„í•˜ëŠ” ê²ƒì´ ë³¸ ëŒ€íšŒì˜ í•µì‹¬ ê³¼ì œì…ë‹ˆë‹¤.

#### [2025 ì œ 5íšŒ SNU FastMRI Challenge ìƒì„¸](https://fastmri.snu.ac.kr/)
* í•™ë¶€ìƒ 1-2ì¸ 1íŒ€
* ëŒ€íšŒ ê¸°ê°„: 2025ë…„ 7ì›” 1ì¼ - 8ì›” 20ì¼
* ìƒê¸ˆ ê·œëª¨: 2,000ë§Œì›(1ë“± 1,000ë§Œì›)
* ì°¸ì—¬ ì¸ì›: 235ëª…(154íŒ€, ë“±ë¡ ë§ˆê° ì „ë‚  ê¸°ì¤€)
* ì‚¬ìš© í™˜ê²½: NVIDIA GTX 1080, 8GB VRAM ì œí•œ ([VESSL AI](https://vessl.ai/ko) ì œê³µ)
* Inference time ì œí•œ: 3,600ì´ˆ
* Dataset (NYU FastMRI datasetì˜ ì¬ê°€ê³µëœ ë°ì´í„°)
    * ë‡Œ/ë¬´ë¦ MRI ì˜ìƒ, multi-coiled k-space & image data
    * ê°€ì†: X4, X8 (ê³µê°œ ë°ì´í„°ëŠ” ëª¨ë‘ ë“±ê°„ê²©)
    * í•™ìŠµìš© ë°ì´í„° í¬ê¸°
        * ë¶€ìœ„-ê°€ì† ìŒ ê°ê°ì— ëŒ€í•´ 85ê°œì˜ train data, 15ê°œì˜ validation data
* ì‚¬ì „ í•™ìŠµëœ ëª¨ë¸ ê°€ì¤‘ì¹˜ ë˜ëŠ” ì™¸ë¶€ ë°ì´í„° ì‚¬ìš© ë¶ˆê°€

---

## 2. Team sMaRtIfy - ì„±ê³¼

#### (1) ì¤‘ê°„í‰ê°€ 1ìœ„ | SSIM = 0.9737 @ 17:00, Aug 8

![image](docs/mid_eval.png)

#### (2) ê³µê°œ ë¦¬ë”ë³´ë“œ 1ìœ„ | SSIM = 0.9746 @ 0:00, Aug 14

![image](docs/open_eval.png)

#### (3) ìµœì¢… ì œì¶œ | SSIM = 0.9748 @ 23:59, Aug 20

![image](docs/last_eval.png)

#### (4) ìµœì¢… ìˆœìœ„ â“ìœ„ | ë¹„ê³µê°œ ë¦¬ë”ë³´ë“œ SSIM = 0.XXXX

---

## 3. ëª¨ë¸ êµ¬ì¡° ë° í•™ìŠµ ì „ëµ

#### ğŸ¤– Backbone: PromptMR+

ì €í¬ì˜ ëª¨ë¸ì€ [Xin et al.ì˜ PromptMR+](https://link.springer.com/chapter/10.1007/978-3-031-73226-3_10) êµ¬ì¡°ë¥¼ ë”°ë¦…ë‹ˆë‹¤. ë…¼ë¬¸ì— ë”°ë¥´ë©´ PromptMR+ëŠ” ê°ì¢… ë°ì´í„°ì…‹ì—ì„œ SOTAì— í•´ë‹¹í•˜ëŠ” í‰ê°€ ê²°ê³¼ë¥¼ ì–»ì–´ëƒˆìŠµë‹ˆë‹¤. PromptMR+ê°€ ê¸°ì¡´ì˜ ëª¨ë¸ê³¼ ë‹¤ë¥¸ ì ì€ ë‹¤ìŒì˜ ì„¸ ê°€ì§€ì…ë‹ˆë‹¤.

1. **ìê¸°-ì ì‘ì (Self-Adaptive) ê·¸ë˜ë””ì–¸íŠ¸ í•™ìŠµ**
    - MRI ì˜ìƒ ë‚´ ì˜ì—­ë³„ ë‚œì´ë„ê°€ ë‹¤ë¦„ â†’ í”½ì…€ ë‹¨ìœ„ë¡œ í•™ìŠµë¥ ì„ ì¡°ì ˆ
    - ë°°ê²½ì²˜ëŸ¼ ë‹¨ìˆœí•œ ì˜ì—­ì€ í° ë³€í™”, ë³µì¡í•œ êµ¬ì¡°ëŠ” ë¯¸ì„¸ ì¡°ì •
    - CNN ê¸°ë°˜ í™•ì¥ìœ¼ë¡œ ì•ˆì •ì„± ë° í•™ìŠµ í‘œí˜„ë ¥ ê°•í™”

2. **ëª¨ë©˜í…€ ê°€ì†(Momentum-Accelerated) ê¸°ë²•**
    - ë°˜ë³µ ë‹¨ê³„ë§ˆë‹¤ íŠ¹ì§• ë§µì„ ëª¨ì•„(concatenate) ì „ë‹¬ â†’ RNNì²˜ëŸ¼ â€œê¸°ì–µâ€ ê¸°ëŠ¥ ìˆ˜í–‰
    - Channel Attention Blockìœ¼ë¡œ ì¤‘ìš”í•œ ì •ë³´ë§Œ ê°•í™”
    - ë°˜ë³µ ê°„ ì •ë³´ ì†ì‹¤ì„ ë§‰ê³  ìˆ˜ë ´ ì†ë„ ê°œì„ 

3. ë©”ëª¨ë¦¬ íš¨ìœ¨ì  ì¸ì ‘ ì •ë³´ ê¸°ë°˜ ë¯¼ê°ë„ ë§µ(Sensitivity Map) ì¶”ì •
    - ë‹¤ì¤‘ ì½”ì¼ MRIì—ì„œëŠ” ì½”ì¼ë³„ ë¯¼ê°ë„ ë§µì´ í•„ìš”
    - ê¸°ì¡´ì—” ì½”ì¼ë³„/ìŠ¬ë¼ì´ìŠ¤ë³„ë¡œ ë”°ë¡œ ê³„ì‚°í•´ ë©”ëª¨ë¦¬ ë¶€ë‹´ í¼
    - ë³¸ ì—°êµ¬ëŠ” ì¸ì ‘ ìŠ¬ë¼ì´ìŠ¤ ì •ë³´ ê³µìœ ë¥¼ í™œìš©í•´ ì—°ì‚° íšŸìˆ˜ë¥¼ í¬ê²Œ ì¤„ì´ê³  ì •í™•ë„ í–¥ìƒ
    - ê²°ê³¼: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì•½ 55% ì ˆê°

ì´ ì¤‘ team sMaRtIfyê°€ ë³¸ challengeì—ì„œ í™œìš©í•œ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œëŠ” 1ë²ˆê³¼ 2ë²ˆì´ ìˆìœ¼ë©°, 3ë²ˆì˜ ê²½ìš° êµ¬í˜„ìƒì˜ ë³µì¡í•¨ ë° ì¶”ê°€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë¬¸ì œë¡œ í™œìš©í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

í•™ìŠµ ê¸°ë³¸ ì„¤ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
- Cascade ìˆ˜: 8ê°œ (ì› ì €ìëŠ” 12)
- 3ë‹¨ prompt block, channel attention (CA) ëª¨ë“ˆ í¬í•¨
- `adaptive_input=True`, `n_buffer=4`, `n_history=3`ì„ í†µí•´ ì”ì°¨/history featureë¥¼ ìœ ì—°í•˜ê²Œ ê²°í•©
- ìµœì¢… ì¶œë ¥ì€ `384Ã—384`ë¡œ center crop

#### ğŸ‘› GPU VRAM ì ˆì•½ ì „ëµ

- ì²´í¬í¬ì¸íŒ…: `--use-checkpoint True`ë¡œ í™œì„±í™” (ê¸°ë³¸ê°’ True)
    - _**Reentrant Wrapper**_
        ```python
        class ReentrantWrapper(nn.Module):

            DEFAULT_CHECKPOINT = True
            
            class _DummyWrapper(nn.Module):
                def __init__(self, module):
                    super().__init__()
                    self.module = module
            
                def forward(self, *args):
                    x, dummy = args[:-1], args[-1]
                    return self.module(*x)
                    
            def __init__(
                self, 
                module: nn.Module, 
                use_checkpoint: Optional[bool] = None
            ):
                super().__init__()
                
                self.use_checkpoint = use_checkpoint or self.DEFAULT_CHECKPOINT
                self._dummy_tensor = nn.Parameter(torch.ones(1, requires_grad=True))
                
                self.module = self._DummyWrapper(module)
            
            def forward(self, *args):
                if self.use_checkpoint and self.training:
                    return checkpoint(self.module, *args, self._dummy_tensor, use_reentrant=True)
                else:
                    return self.module(*args, self._dummy_tensor)
        ```
        VRAM ì‚¬ìš©ëŸ‰ì„ íšê¸°ì ìœ¼ë¡œ ì¤„ì—¬ì£¼ëŠ” reentrant checkpointingì´ ì…ë ¥ ì¤‘ gradient ì—°ì‚°ì„ í—ˆìš©í•˜ëŠ” í…ì„œê°€ ìˆì–´ì•¼ í•¨ì„ ì´ìš© 
        
        â†’ `dummy` í…ì„œë¥¼ í•¨ê»˜ ì…ë ¥í•´ ìë™ìœ¼ë¡œ reentrant checkpointing í™œì„±í™”
        â†’ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ë§ì€ `sens_map`ì— ì ìš©

- ëª¨ë¸ í¬ê¸° ì¶•ì†Œ
    - ì›ë³¸ PromptMR+ ëŒ€ë¹„ ì±„ë„ ìˆ˜ë¥¼ ë‚®ì¶° 8GB VRAM ì œì•½ ëŒ€ì‘
    - íŒŒë¼ë¯¸í„° ìˆ˜ë¥¼ *í•˜ë‚˜ë§Œ ëŠ˜ë ¤ë„* CUDA out of memoryê°€ ë°œìƒí•˜ëŠ” ìˆ˜ì¤€ìœ¼ë¡œ í¬ê²Œ ì„¤ì •
        ```python
        # --- MODEL HYPERPARAMETERS -------------------------------------------------------------------------------------------
        parser.add_argument('--num-cascades', type=int, default=8, help='Number of cascades | 12 in original PromptMR+')
        parser.add_argument('--n-feat0', type=int, default=8, help='Number of feat0 | 48 in original PromptMR+')
        parser.add_argument('--feature-dim', type=List[int], default=[24, 32, 40], help='Sizes of feature dimension | [72, 96, 120] in original PromptMR+')
        parser.add_argument('--prompt-dim', type=List[int], default=[8, 16, 24], help='Sizes of prompt dimension | [24, 48, 72] in original PromptMR+')
        parser.add_argument('--sens-n-feat0', type=int, default=8, help='Number of feat0 for sensitivity map | 24 in original PromptMR+')
        parser.add_argument('--sens-feature-dim', type=List[int], default=[12, 16, 20], help='Sizes of sensitivity feature dimension | [36, 48, 60] in original PromptMR+')
        parser.add_argument('--sens-prompt-dim', type=List[int], default=[4, 8, 12], help='Sizes of sensitivity-prompt dimension | [12, 24, 36] in original PromptMR+')
        parser.add_argument('--len-prompt', type=List[int], default=[3, 3, 3], help='Length of prompt vectors per level | [3, 3, 3] in original PromptMR+')
        parser.add_argument('--prompt-size', type=List[int], default=[16, 8, 4], help='Spatial size of prompt per level | [64, 32, 16] in original PromptMR+')
        parser.add_argument('--n-enc-cab', type=List[int], default=[2, 3, 3], help='Number of CABs in encoder blocks | [2, 3, 3] in original PromptMR+')
        parser.add_argument('--n-dec-cab', type=List[int], default=[2, 2, 3], help='Number of CABs in decoder blocks | [2, 2, 3] in original PromptMR+')
        parser.add_argument('--n-skip-cab', type=List[int], default=[1, 1, 1], help='Number of CABs in skip connections | [1, 1, 1] in original PromptMR+')
        parser.add_argument('--n-bottleneck-cab', type=int, default=3, help='Number of CABs in bottleneck block | 3 in original PromptMR+')
        parser.add_argument('--no-use-ca', type=bool, default=False, help='Disable channel attention module in CABs | False in original PromptMR+')

        # Plus implementations
        parser.add_argument('--adaptive-input', type=bool, default=True, help='Use residual adaptive input in Unet encoder | True in PromptMR+')
        parser.add_argument('--n-buffer', type=int, default=4, help='Number of internal feature buffers in PromptMRBlock | 4 in original PromptMR+')
        parser.add_argument('--n-history', type=int, default=3, help='Duration of history consideration | 11 in PromptMR+')
        parser.add_argument('--use-sens-adj', type=bool, default=True, help='Use adjacent slices when estimating sensitivity map | True in PromptMR+')
        # =====================================================================================================================
        ```
    - ì½”ë“œ ë‚´ë¶€ `reduction` íŒŒë¼ë¯¸í„° ë³€ê²½ **(16 â†’ 2)**
    : ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ìµœì†Œí•œìœ¼ë¡œ ëŠ˜ë¦¬ë©´ì„œ `feat_0`ì˜ í° ê°ì†Œí­ì— ë”°ë¥¸ í‘œí˜„ë ¥ ì•½í™”ë¥¼ ì™„í™”
        ![image](docs/reduction.png)

- `sens_map` ì¶”ì • ì‹œ per-coil ì—°ì‚° ì˜µì…˜ìœ¼ë¡œ ìµœëŒ€ ë©”ëª¨ë¦¬ ì œì–´(ì›ë³¸ ì½”ë“œì—ì„œ ì§€ì›)

#### ğŸ˜ˆ *Hacker-Helper ì „ëµ*

- `Hacker`: ê³µê°œ ë°ì´í„°ì—ì„œ í™•ì¸ë˜ëŠ” ë“±ê°„ê²© k-space mask íŒ¨í„´ì— ìµœì í™”ëœ ë‹¨ì¼ ì „ë¬¸ê°€.
    - `'./FastMRI_challenge_sMaRtIfy_ver2/experiments/fastmri mask types.xlsx'` ì°¸ì¡°
    - ê³µê°œëœ ëª¨ë“  ë°ì´í„°ì˜ k-space maskëŠ” ë‹¤ìŒì˜ ê·œì¹™ì„ ë”°ë¼ ë§Œë“¤ì–´ì§ì„ ë°œê²¬í•¨
        ```python
        start_idx = (width // 2) % acc
        ```
        - ì„±ìˆ˜ğŸ—£ï¸ *"Overfittingì„ ìœ ë„í•˜ê¸° ìœ„í•´ ì¤„ë¬´ëŠ¬ì˜ ìœ„ì¹˜ë¥¼ ê³ ì •í–ˆì„ ê²ƒì´ë‹¤"*
        - ìš°ì§„ğŸ—£ï¸ *"ê¹Šê²Œ ìƒê°í•˜ì§€ ì•Šì•˜ê±°ë‚˜, ìƒê°ì—†ì´ mask augmentí•œ íŒ€ì„ ì €ê²©í–ˆì„ ê²ƒì´ë‹¤"*
    - ë‘ ê²½ìš°ì˜ ìˆ˜ ëª¨ë‘ì— ëŒ€ì‘í•  ìˆ˜ ìˆë„ë¡ ëª¨ë¸ì„ ë‘ ê°€ì§€ë¡œ ì„¤ê³„
    â†’ **Hacker: ì˜ë„ì ìœ¼ë¡œ ê³µê°œëœ ë°ì´í„°ì˜ íŒ¨í„´ì— ì˜¤ë²„í”¼íŒ…**
- `Helper`: ë¹„ê³µê°œ ë¦¬ë”ë³´ë“œì—ì„œì˜ mask ë¶„í¬ ë³€í™”ì— ê°•ê±´í•˜ë„ë¡ k-space mask ì¦ê°•ì„ ì ìš©.
    - ë¬´ì‘ìœ„ `start_idx`ë¥¼ í†µí•´ ë§Œë“  ë“±ê°„ê²© mask 50%
    - ì™„ì „íˆ ë¬´ì‘ìœ„ë¡œ ì¶”ì¶œí•˜ì—¬ ë§Œë“¤ì–´ì§€ëŠ” mask 50% 
- ë‘ ê³„ì—´ ëª¨ë‘ ë™ì¼í•œ ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ mask ì¦ê°•ì„ ì œì™¸í•œ ëª¨ë“  ë‹¨ê³„ì—ì„œ ë™ì¼í•˜ê²Œ í•™ìŠµ
- ì¶”ë¡  ë‹¨ê³„ì—ì„œëŠ” `Broker()` ëª¨ë“ˆì„ í†µí•´ hacked maskì¸ì§€ êµ¬ë³„í•˜ì—¬ ë‘˜ ì¤‘ í•œ ëª¨ë¸ì— ì „ë‹¬
- Leaderboard í‰ê°€ ê²°ê³¼
    - Hacker: SSIM = **0.9748**
    - Helper: SSIM = **0.9746** (- 0.0002 + robustness)

#### ğŸ§ª Validation Data í™œìš©

- `--use-val-for-final` ì…ë ¥ì„ í†µí•´ validation dataë¥¼ í•™ìŠµì— ì‚¬ìš©í• ì§€ ê²°ì • ê°€ëŠ¥
    - ì œì¶œìš© ëª¨ë¸ì—ì„œëŠ” `use_val_for_final = True`ë¡œ ì„¤ì •í•˜ì—¬ ì¼ë°˜í™” ì„±ëŠ¥ í–¥ìƒ
    - íƒ€ ì„œë²„ì—ì„œ ë™ì¼ ì½”ë“œë¥¼ `use_val_for_final = False`ë¡œ ì‹¤í–‰í•˜ì—¬ ì—í­ë³„ ì¼ë°˜í™” ì„±ëŠ¥ ì¸¡ì •
        - ì¼ë°˜í™” ì„±ëŠ¥ì´ í¬í™”ë˜ì–´ ê³¼ì í•©ì´ ì‹œì‘ë˜ëŠ” 30ì—í­ë¶€í„° MRAugment ì ìš© ê³„íš
        - `'./FastMRI_challenge_sMaRtIfy_ver2/experiments/terminal_log/'`ì˜ `'[external] hacker_baseline_val.txt'` ì°¸ê³ 
        - ì´ë¥¼ ë¬´ì‹œí•˜ê³  45ì—í­ì—ì„œ MRAugment ì ìš©ì‹œ ìµœì¢… SSIMì´ ê°ì†Œí•¨ì„ í™•ì¸(**0.9743**)

#### ğŸ“‰ Loss ì„¤ê³„

- ê¸°ë³¸ í•¨ìˆ˜: SSIMLoss (`utils/common/loss_function.py`)
- ì¶”ê°€ í•¨ìˆ˜: `--regularizer-loss {L1|L2}`ë¡œ ë³´ì¡° í‰ê°€ë¥¼ ì—í­ ê¸°ì¤€ìœ¼ë¡œ í™œì„± ê°€ëŠ¥
    - ë³¸ ëŒ€íšŒì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
- ë§ˆìŠ¤í¬ ê°€ì¤‘ì¹˜
    - ì´ë¯¸ì§€ ë§ˆìŠ¤í¬(`gamyun`)ë¡œ ë¬´íš¨ ì˜ì—­ì„ ê°€ë¦¼ (ë¹ ë¥¸ ìˆ˜ë ´ ë° ë™ì¼ ì¡°ê±´ì—ì„œ **+0.0004** í™•ì¸)
        - ê°€ë¦´ ì˜ì—­ì˜ ì„¸ê¸° ì„¤ì • ê°€ëŠ¥(ë³¸ ëŒ€íšŒì—ì„œëŠ” 0 ì ìš©)
    - ë‚¨ì•„ìˆëŠ” ë©´ì  ë¹„ìœ¨ì— ë¹„ë¡€í•œ ìŠ¤ì¹¼ë¼ ê°€ì¤‘ì¹˜(âˆšarea - ë„“ì€ ì´ë¯¸ì§€ì¼ìˆ˜ë¡ ë” ë§ì€ íŠ¹ì§•ì´ ìˆì„ ê²ƒìœ¼ë¡œ ì¶”ë¡ )ë¥¼ ì ìš© (ë™ì¼ ì¡°ê±´ì—ì„œ **+0.0008** í™•ì¸)
        ![image](docs/sqrt.png)
    - ë‘ ë°©ë²• ëª¨ë‘ 0ì—í­ë¶€í„° ì ìš©

#### ğŸ‘¯â€â™€ï¸ Mixture of Experts (MoE)

- ì „ë¬¸ê°€ 4ê°œ: {brainÃ—acc4, brainÃ—acc8, kneeÃ—acc4, kneeÃ—acc8}
- ë¶„ê¸° ë°©ì‹: ë¶„ë¥˜ê¸° ì¶œë ¥(`class_label`)ì„ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ ì „ë¬¸ê°€ ê²½ë¡œë¡œ ë³µì› ìˆ˜í–‰
    - í•™ìŠµ ì‹œì—ëŠ” `'dummy'` ë¶„ë¥˜ê¸°ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ëª…ìœ¼ë¡œ êµ¬ë¶„
    - ì¶”ë¡  ì‹œì—ëŠ” ResNet êµ¬ì¡°ì¸ `'awesome_classifier_ver2.pt'` ì´ìš©
- ì¶”ì • íš¨ê³¼: **+0.0002**

    ##### ğŸ”€ Brain-Knee Classifier êµ¬í˜„

    - ResNet50 ì‚¬ìš©
    - ì œê³µë˜ëŠ” Grappa imageë¥¼ ì…ë ¥ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ dataloaderì—ì„œ ë¯¸ë¦¬ íŒŒì¼ë³„ë¡œ ë¶„ë¥˜
    - `nn.BatchNorm()` ë° `batch_size = 16` ì ìš© â†’ ì•ˆì •ì  í•™ìŠµ
    - ì¶”ê°€ì ì¸ Lasso loss í•­ ì¶”ê°€ â†’ ì¼ë°˜í™” ì„±ëŠ¥ í–¥ìƒ
    - `CosineAnnealingLR()` ì‚¬ìš© â†’ local minimaë¥¼ ì—¬ëŸ¬ ë²ˆ ë²—ì–´ë‚˜ê²Œ ì„¤ê³„
    - Validation setìœ¼ë¡œ í›ˆë ¨, train setìœ¼ë¡œ ê²€ì¦ â†’ 100ì—í­ ì¤‘ val lossê°€ ê°€ì¥ ë‚®ì€ ëª¨ë¸ ì„ íƒ
        - Train setì˜ 4937ê°œ slice ì¤‘ 1ê°œ ì˜¤ë¶„ë¥˜ â†’ íŒŒì¼ ìˆ˜ì¤€ ë°°ì¹˜ì²˜ë¦¬ì—ì„œëŠ” ë¬´ì‹œë¨
        - ì¬í˜„ì„±ì€ `./FastMRI_challenge_sMaRtIfy_ver2/experiments/terminal_log/`ì˜ `[IABENG41] awesome_classifier_ver2.txt` ì°¸ê³ 

#### ğŸ«¥ Augmentation: MRAugment ë° K-Space Mask ì¦ê°•

- MRAugment: ê¸°í•˜ì  ë³€í™˜ ê¸°ë°˜ì˜ ì¦ê°•ì„ ìŠ¤ì¼€ì¤„ë§(`exp`)í•˜ë©°, brain/knee ê°ê°ì˜ ë¶„í¬ë¥¼ ê´€ì°°í•˜ì—¬ ë‹¤ë¥¸ íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©(MoE ë‹¨ê³„ë¶€í„° ì ìš©)
    ![image](docs/mraug.png)
    ```python
    # Brain augmentation
    parser.add_argument('--brain-aug-delay', type=int, default=3) # Starting epoch is added later
    parser.add_argument('--brain-aug-strength', type=float, default=0.5)
    parser.add_argument('--brain-aug-weight-translation', type=float, default=1.)
    parser.add_argument('--brain-aug-weight-rotation', type=float, default=1.)
    parser.add_argument('--brain-aug-weight-shearing', type=float, default=1.)
    parser.add_argument('--brain-aug-weight-scaling', type=float, default=1.)
    parser.add_argument('--brain-aug-weight-rot90', type=float, default=0.)
    parser.add_argument('--brain-aug-weight-fliph', type=float, default=0.4) # Considering asymmetry of Wernicke's area
    parser.add_argument('--brain-aug-weight-flipv', type=float, default=0.)
    parser.add_argument('--brain-aug-max-translation-x', type=float, default=0.03)
    parser.add_argument('--brain-aug-max-translation-y', type=float, default=0.05)
    parser.add_argument('--brain-aug-max-rotation', type=float, default=5.)
    parser.add_argument('--brain-aug-max-shearing-x', type=float, default=5.)
    parser.add_argument('--brain-aug-max-shearing-y', type=float, default=5.)
    parser.add_argument('--brain-aug-max-scaling', type=float, default=0.12)

    # Knee augmentation
    parser.add_argument('--knee-aug-delay', type=int, default=3) # Starting epoch is added later
    parser.add_argument('--knee-aug-strength', type=float, default=0.5)
    parser.add_argument('--knee-aug-weight-translation', type=float, default=1.)
    parser.add_argument('--knee-aug-weight-rotation', type=float, default=1.)
    parser.add_argument('--knee-aug-weight-shearing', type=float, default=1.)
    parser.add_argument('--knee-aug-weight-scaling', type=float, default=1.)
    parser.add_argument('--knee-aug-weight-rot90', type=float, default=0.)
    parser.add_argument('--knee-aug-weight-fliph', type=float, default=0.5)
    parser.add_argument('--knee-aug-weight-flipv', type=float, default=0.)
    parser.add_argument('--knee-aug-max-translation-x', type=float, default=0.08)
    parser.add_argument('--knee-aug-max-translation-y', type=float, default=0.08)
    parser.add_argument('--knee-aug-max-rotation', type=float, default=5.)
    parser.add_argument('--knee-aug-max-shearing-x', type=float, default=10.)
    parser.add_argument('--knee-aug-max-shearing-y', type=float, default=10.)
    parser.add_argument('--knee-aug-max-scaling', type=float, default=0.12)
    ```
    - ë¶„í¬ì˜ í˜•íƒœê°€ ë³€í•˜ì§€ ì•ŠëŠ” ì„ ì—ì„œ ìµœëŒ€í•œ extrapolateë˜ë„ë¡ ì¦ê°• ê°•ë„ ì„¤ì •
        ![image](docs/distribution.png)
    - Brainì˜ ê²½ìš° Wernicke ì˜ì—­ì˜ ì¢Œìš° ë¹„ëŒ€ì¹­ì„±ì„ ê³ ë ¤í•˜ì—¬ ì¢Œìš°ëŒ€ì¹­ í™•ë¥  40%ë¡œ ì„¤ì •
    - Scheduling: 33ì—í­ë¶€í„° ì§€ìˆ˜ì  ì¦ê°€, 50ì—í­ì— ì¦ê°• í™•ë¥  50% ì ìš©í•˜ì—¬ ìœ ì§€
    - ì¶”ì • íš¨ê³¼: **+0.0009**
- K-space ë§ˆìŠ¤í¬ ì¦ê°•: Helper í›ˆë ¨ì—ì„œ ì ìš©í•˜ì—¬ ë¹„ê³µê°œ ë°ì´í„°ì˜ ë¶„í¬ ë³€í™”ì— ëŒ€í•œ ê°•ê±´ì„± í™•ë³´
    - 0-15ì—í­: ì¦ê°• x
    - 16-25ì—í­: ì¦ê°• í™•ë¥  0% â†’ 100% ì§€ìˆ˜ì  ì¦ê°€
    - 26-29ì—í­: ì¦ê°• í™•ë¥  100%ë¡œ ìœ ì§€
    - 30-59ì—í­: ì¦ê°• í™•ë¥  100%, **hacked maskëŠ” ì œì™¸í•˜ê³  ë‹¤ì‹œ ì¶”ì¶œ**

#### ğŸ—“ï¸ Learning Rate Scheduling

- Baseline: `StepLR` + `--scheduler-start-epoch`
    - `lr=2e-4`ë¡œ ì‹œì‘, 16ì—í­ê³¼ 27ì—í­ì—ì„œ ê°ê° 0.3ë°°
- MoE: `LinearLR` â†’ `ConstantLR` â†’ `StepLR`ì˜ ìˆœì°¨ ìŠ¤ì¼€ì¤„
    - 30-32ì—í­ `LinearLR`: MoEì— ë”°ë¥¸ ë°ì´í„° ë¶„í¬ ê¸‰ë³€ ì™„í™”
    - 33-38ì—í­ `ConstantLR`: MRAugment ì¦ê°• ë°ì´í„°ì˜ íŠ¹ì§• ì§‘ì¤‘ í•™ìŠµ
    - 39-59ì—í­ `StepLR`: MRAugment í¬í™” ì´í›„ ê³ ì°¨ì›ì  íŠ¹ì§• í•™ìŠµ

---

## 4. ì¬í˜„ ê°€ì´ë“œ

ë³¸ ëª¨ë¸ì˜ ì¬í˜„ ë°©ì‹ì€ ë²„ì „ì— ë”°ë¼ ë‘ ê°€ì§€ë¡œ ë‚˜ë‰©ë‹ˆë‹¤. êµ¬ì²´ì ì¸ ì‹¤í—˜ ë°©ì‹ì€ ```./FastMRI_challenge_sMaRtIfy_ver2/README.md``` ë˜ëŠ” ```./FastMRI_challenge_sMaRtIfy_final/README.md```ë¥¼ ì°¸ê³ í•˜ì„¸ìš”. 

âš ï¸ í•œ ì„œë²„ì—ì„œ ì‹¤í—˜í•  ê²½ìš° ì „ì²´ ì¬í˜„ ì‹œê°„ì´ **26ì¼**ì— ë‹¬í•˜ë‹ˆ hackerì™€ helperëŠ” ë”°ë¡œ í›ˆë ¨í•´ì£¼ì„¸ìš”.

* ```./FastMRI_challenge_sMaRtIfy_ver2/``` : ëª¨ë¸ì˜ ì‹¤ì œ í›ˆë ¨ ê³¼ì •ê³¼ ë™ì¼í•œ ì½”ë“œë¥¼ ì‚¬ìš©í•œ ë²„ì „ì…ë‹ˆë‹¤. **ìµœëŒ€í•œì˜ ì¬í˜„ì„±ì— ì´ˆì ì„ ë‘ëŠ” ê²½ìš° ì‚¬ìš©ì„ ê¶Œì¥**í•˜ë‚˜, ëŒ€íšŒ ê¶Œì¥ ì‚¬í•­ì„ ëª¨ë‘ ì§€ì¼°ìŒì—ë„ ë§¤ iterì—ì„œì˜ 0.000X ë‹¨ìœ„ loss ì¬í˜„ì€ ë˜ì§€ ì•Šìœ¼ë‹ˆ ì°¸ê³ í•˜ì—¬ ì‹¤í–‰í•´ì£¼ì„¸ìš”. ëŒ€ë¶€ë¶„ì˜ random seedëŠ” ê³ ì •ë˜ì—ˆìŒì„ í•´ë‹¹ ë²„ì „ì˜ ```./experiments/terminal_log/```ì— ìœ„ì¹˜í•œ ```[iabeng71] randomness_reproducibility_5epoch.txt```ì—ì„œ ë¹„êµëŒ€ì¡°í•˜ì—¬ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        

* ```./FastMRI_challenge_sMaRtIfy_final/``` : ì œì¶œìš© ëª¨ë¸ê³¼ ë™ì¼í•œ ì•Œê³ ë¦¬ì¦˜ì„ ìƒëŒ€ì ìœ¼ë¡œ ê°„ê²°í•œ ëª…ë ¹ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì½”ë“œ ë˜í•œ ê±°ì˜ ë™ì¼í•˜ë‚˜, ë²„ì „ 2ì—ì„œ ì¬í˜„ë˜ëŠ” ìˆ˜ì¤€ìœ¼ë¡œëŠ” seedê°€ ê³ ì •ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ëª¨ë¸ ë° í•™ìŠµ ì•Œê³ ë¦¬ì¦˜ì˜ ì´í•´ë¥¼ ìœ„í•œ ë²„ì „ì´ê¸°ë„ í•©ë‹ˆë‹¤.

    ì£¼ìš”í•œ ì°¨ì´ë¥¼ ì¼ìœ¼í‚¤ëŠ” ì½”ë“œ(helper)ëŠ” ê³µê°œ ë¦¬ë”ë³´ë“œ ì ìˆ˜ì™€ ë¬´ê´€í•˜ë¯€ë¡œ, ì–´ëŠ ì •ë„ëŠ” ë³¸ ë²„ì „ì„ ì‚¬ìš©í•˜ì—¬ ì¬í˜„í•´ë„ ë¬´ë°©í•©ë‹ˆë‹¤.

#### ì‹œë“œ ê³ ì • ì „ëµ

* torch/numpy/random ì „ì—­ ì‹œë“œ ê³ ì •
    `utils/common/utils.py::seed_fix`
* ì¦ê°• íŒŒì´í”„ë¼ì¸ ì‹œë“œ ë³„ë„ ê³ ì •
    `DataAugmentor.seed_pipeline(seed+2000)`
* K-space mask ì¦ê°• ì‹œ ì‹œë“œ ë³„ë„ ê³ ì •
    `self.rng = np.random.RandomState(seed + 1000 if seed is not None else None)`
* Checkpoints ì¬ê°œ ì‹œ optimizer/scheduler ìƒíƒœ ë³µì› ì˜µì…˜ ì œê³µ

---

## 5. References

[[1](https://link.springer.com/chapter/10.1007/978-3-031-73226-3_10)] Xin, B., Ye, M., Axel, L. and Metaxas, D.N., 2024, September. Rethinking deep unrolled model for accelerated MRI reconstruction. In European Conference on Computer Vision (pp. 164-181). Cham: Springer Nature Switzerland.

[[2](https://arxiv.org/abs/2106.14947)] Fabian, Z., Heckel, R. and Soltanolkotabi, M., 2021, July. Data augmentation for deep learning based accelerated MRI reconstruction with limited data. In International Conference on Machine Learning (pp. 3057-3067). PMLR.